<!DOCTYPE html>
<html lang="no">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Booking av treningsrom</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h1 {
            margin-bottom: 5px;
            text-align: center;
        }

        table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
            font-size: 14px;
        }

        th {
            background-color: #f0f0f0;
        }

        td.time {
            font-weight: bold;
            background-color: #fafafa;
            width: 80px;
        }

        td.slot {
            min-width: 120px;
            cursor: pointer;
            background-color: #d4edda; /* Grønn for ledig */
        }

        td.slot.taken {
            background-color: #f8d7da; /* Rød for opptatt */
            color: #721c24;
            cursor: not-allowed;
        }

        /* Responsiv design for små skjermer */
        @media screen and (max-width: 768px) {
            table {
                font-size: 12px;
            }

            th,
            td {
                padding: 5px;
            }

            td.time,
            td.slot {
                display: block;
                text-align: left;
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <h1>Booking av treningsrom</h1>
    <p>Velg en ledig tid ved å klikke på den. Bookingen blir merket som opptatt. Klikk på en opptatt tid for å gjøre den ledig igjen.</p>

    <table>
        <thead>
            <tr>
                <th>Tid</th>
                <th>Booking</th>
            </tr>
        </thead>
        <tbody id="calendar-body">
        </tbody>
    </table>

    <script type="module">
        // Firebase konfigurasjon
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, deleteDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey:  "AIzaSyALGMHGqQwAzP96ajyyACqsCl8zQc_-0ww",
            authDomain: "stokkesgym.firebaseapp.com",
            projectId: "stokkesgym",
            storageBucket: "stokkesgym.firebasestorage.app",
            messagingSenderId: "799505110904",
            appId: "1:799505110904:web:bbb58abd42774477365a8d"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const startHour = 6;
        const endHour = 23;
        const tbody = document.getElementById("calendar-body");

        // Funksjon som genererer tidene i tabellen
        async function generateTimes() {
            console.log("Genererer tider...");
            for (let hour = startHour; hour <= endHour; hour++) {
                const row = document.createElement("tr");

                // Tidene vises i første kolonne
                const timeCell = document.createElement("td");
                timeCell.className = "time";
                timeCell.textContent = `${hour}:00`;
                row.appendChild(timeCell);

                // Booking-statusen vises i andre kolonne
                const slotCell = document.createElement("td");
                slotCell.className = "slot";
                slotCell.setAttribute("data-hour", hour);

                // Sjekk om denne timen er opptatt i Firestore
                const bookingDoc = await getDoc(doc(db, "bookings", `${hour}:00`));
                if (bookingDoc.exists()) {
                    slotCell.classList.add("taken");
                    slotCell.textContent = "Opptatt";
                    slotCell.style.backgroundColor = "#f8d7da"; // Rød bakgrunn
                } else {
                    slotCell.textContent = "Ledig"; // Standard tekst for ledig
                    slotCell.style.backgroundColor = "#d4edda"; // Grønn bakgrunn
                }

                // Klikk-funksjon for å markere som opptatt eller tilbake til ledig
                slotCell.onclick = async function () {
                    if (slotCell.classList.contains("taken")) {
                        // Hvis den er opptatt, gjør den ledig
                        slotCell.classList.remove("taken");
                        slotCell.textContent = "Ledig";
                        slotCell.style.backgroundColor = "#d4edda"; // Tilbake til grønn

                        // Slett booking fra Firestore
                        await deleteDoc(doc(db, "bookings", `${hour}:00`));
                    } else {
                        // Hvis den er ledig, gjør den opptatt
                        slotCell.classList.add("taken");
                        slotCell.textContent = "Opptatt";
                        slotCell.style.backgroundColor = "#f8d7da"; // Rød bakgrunn

                        // Sett booking i Firestore
                        await setDoc(doc(db, "bookings", `${hour}:00`), {
                            status: "opptatt",
                            time: `${hour}:00`
                        });
                    }
                };

                row.appendChild(slotCell);
                tbody.appendChild(row);
            }
            console.log("Tider generert.");
        }

        // Kall funksjonen for å generere tidene
        window.onload = function () {
            console.log("Dokumentet er lastet, genererer tider...");
            generateTimes();
        }
    </script>

</body>

</html>
